<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#05080c" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="apple-touch-icon" href="./assets/icon-192.png" />
  <title>THE WIRED // Y. T.</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div id="boot" class="boot">
    <div class="boot-inner">
      <div class="boot-title">THE WIRED</div>
      <div class="boot-sub">BOOT SEQUENCE // WIRED NODE</div>
      <div class="boot-sub" style="margin-top:6px;opacity:.9">PRESENT TIME // PRESENT DAY</div>
      <div class="boot-bar"><div class="boot-fill"></div></div>
      <div class="boot-hint">do not panic. observe.</div>
    </div>
  </div>

  <div id="offline" class="offline hidden">
    <div class="offline-inner">
      <div class="offline-title">NO CARRIER</div>
      <div class="offline-sub">WIRED DISCONNECTED</div>
    </div>
  </div>

  <canvas id="noise"></canvas>
  <div class="scanlines"></div>
  <div class="vignette"></div>
  <div class="dither"></div>
  <div class="warp"></div>
  <div class="glitch-layer" aria-hidden="true"></div>

  <header class="topbar">
    <div class="brand">
      <div class="sig">PROTOCOL // PERSONAL WIRED LOG</div>
      <div class="name" data-glitch="THE WIRED">THE WIRED</div>
    </div>
    <div class="top-actions">
      <button id="btnRefresh" class="pill">SYNC</button>
      <a class="pill" href="./static.html">STATIC</a>
      <button id="btnAudio" class="pill ghost" title="iOS/PWA audio reconnect">AUDIO</button>
      <button id="btnLogout" class="pill danger hidden">LOGOUT</button>
    </div>
  </header>

  <main class="shell">
    <section class="panel left">
      <div class="panel-title">AUTH GATE</div>

      <div id="authBox" class="auth">
        <label>
          <span>EMAIL</span>
          <input id="email" type="email" autocomplete="email" placeholder="you@wired.net" />
        </label>
        <label>
          <span>PASSWORD</span>
          <input id="password" type="password" autocomplete="current-password" placeholder="••••••••" />
        </label>

        <div class="row">
          <button id="btnLogin" class="pill">LOGIN</button>
          <button id="btnSignup" class="pill ghost">SIGNUP</button>
        </div>

        <p class="hint">
          この端末はノード。認証は扉。<br/>
          “Observe” はあなたの合言葉でもある。
        </p>
      </div>

      <div id="navBox" class="nav hidden">
        <div class="who">
          <div class="dot"></div>
          <div>
            <div class="who-title">CONNECTED</div>
            <div id="whoEmail" class="who-email">-</div>
          </div>
        </div>

        <div class="filters">
          <label>
            <span>KIND</span>
            <select id="kindFilter">
              <option value="ALL">ALL</option>
              <option value="Counselling">Counselling</option>
              <option value="Note">Note</option>
              <option value="Analyse">Analyse</option>
              <option value="Dream">Dream</option>
              <option value="Trace">Trace</option>
              <option value="ErrLog">ErrLog</option>
              <option value="Other">Other</option>
            </select>
          </label>

          <label>
            <span>SEARCH</span>
            <input id="q" type="text" placeholder="keyword / tag / fragment" />
          </label>

          <button id="btnNew" class="pill">+ NEW LOG</button>
        </div>

        <div class="lain">
          <img id="lainImg" src="./assets/wired-girl.png" alt="Wired girl (original character)" />
          <div class="lain-caption">
            <div class="lain-title">WIRED GIRL // PRESENCE</div>
            <div class="lain-sub">original appearance</div>
          </div>
        </div>

        <div id="ghostBox" class="ghostbox">
          <div class="ghost-title">TRACE // RESIDUAL SIGNAL</div>
          <div id="ghostList" class="ghost-list">
            <div class="ghost-empty">NO TRACE</div>
          </div>
          <div class="row" style="margin-top:8px;">
            <button id="btnGhostClear" class="pill ghost">CLEAR TRACE</button>
            <button id="btnGhostOpenStatic" class="pill ghost">OPEN STATIC</button>
          </div>
        </div>

        <div class="small">
          Tip: more noise for scroll or click<br/>
          long text is suit for “WIRED"
        </div>
      </div>
    </section>

    <section class="panel center">
      <div class="panel-title">ARCHIVE</div>
      <div id="list" class="list empty">
        <div class="empty-msg">NO DATA // WAITING FOR NODE SYNC</div>
      </div>
    </section>

    <section class="panel right">
      <div class="panel-title">TERMINAL</div>

      <div id="editor" class="editor locked">
        <div class="locked-msg">
          AUTH REQUIRED // CONNECT TO WIRED
        </div>
      </div>

      <template id="editorTpl">
        <div class="editor-inner">
          <div class="row">
            <label class="grow">
              <span>KIND</span>
              <select id="kind">
                <option value="Counselling">Counselling</option>
                <option value="Note">Note</option>
                <option value="Analyse">Analyse</option>
                <option value="Dream">Dream</option>
                <option value="Trace">Trace</option>
                <option value="ErrLog">ErrLog</option>
                <option value="Other">Other</option>
              </select>
            </label>

            <label style="width:120px">
              <span>MOOD</span>
              <input id="mood" type="number" min="-10" max="10" placeholder="0" />
            </label>
          </div>

          <label>
            <span>TITLE</span>
            <input id="title" type="text" placeholder="signal name" />
          </label>

          <label>
            <span>TAGS (comma)</span>
            <input id="tags" type="text" placeholder="observe, err-002, trace ..." />
          </label>

          <label class="grow">
            <span>BODY</span>
            <textarea id="body" placeholder="write…"></textarea>
          </label>

          <div class="row">
            <button id="btnSave" class="pill">SAVE</button>
            <button id="btnDelete" class="pill danger ghost">DELETE</button>
            <div class="meta grow">
              <div id="metaLine">—</div>
            </div>
          </div>
        </div>
      </template>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-left">TATEMATA NODE // THE WIRED</div>
    <div id="status" class="footer-right">BOOTING…</div>
  </footer>

  <!-- AUDIO GATE (iOS/PWA audio recovery) -->
  <div id="audioGate" class="audio-gate hidden" role="dialog" aria-modal="true">
    <div class="audio-gate-card">
      <div class="audio-gate-title">AUDIO LOST // TAP TO RECONNECT</div>
      <div class="audio-gate-sub">
        iOS/PWA は別の動画・別タブ・ロック復帰後に音が止まることがあります（仕様）。<br/>
        ここをタップして回線を再同期してください。
      </div>
      <div class="audio-gate-actions">
        <button id="btnAudioReconnect" class="pill danger">RECONNECT</button>
        <button id="btnAudioReset" class="pill ghost">RESET AUDIO</button>
        <button id="btnAudioDismiss" class="pill">HIDE</button>
      </div>
      <div id="audioState" class="audio-state">state: n/a</div>
    </div>
  </div>

  <!-- ✅ audio.js を先に -->
  <script src="./audio.js"></script>

  <script type="module" src="./app.js"></script>
  <script type="module" src="./noise.js"></script>
  <script type="module" src="./crt.js"></script>
  <script type="module" src="./ps1.js"></script>

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js");
    }
  </script>
</body>
</html>
